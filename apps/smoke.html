<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smoke Test | Assistenku</title>

  <link rel="manifest" href="/manifest.webmanifest" />
  <link rel="stylesheet" href="/assets/css/app.css" />

  <script src="/assets/config.js"></script>
  <script src="/assets/firebase-config.js"></script>

  <script type="module" src="/assets/apiClient.js"></script>
  <script type="module">
    import { apiHealth, apiWhoAmI, getApiBase } from "/assets/apiClient.js";
    import { getFirebaseAuth, signOutFirebase } from "/apps/shared/firebase.js";

    const logArea = document.getElementById("log");
    const apiBaseEl = document.getElementById("apiBase");
    apiBaseEl.textContent = getApiBase();

    function log(message, isError = false) {
      const row = document.createElement("div");
      row.textContent = typeof message === "string" ? message : JSON.stringify(message, null, 2);
      if (isError) row.classList.add("text-error");
      logArea.prepend(row);
    }

    document.getElementById("btnHealth").addEventListener("click", async () => {
      log("Memanggil /api/health ...");
      try {
        const res = await apiHealth();
        log(res);
      } catch (err) {
        log(err, true);
      }
    });

    document.getElementById("btnWhoAmI").addEventListener("click", async () => {
      const user = getFirebaseAuth().currentUser;
      if (!user) {
        log("Login dulu untuk menguji whoami", true);
        return;
      }
      try {
        const res = await apiWhoAmI();
        log(res);
      } catch (err) {
        log(err, true);
      }
    });

    document.getElementById("btnLogout").addEventListener("click", async () => {
      await signOutFirebase();
      log("Logout selesai");
    });
  </script>

  <style>
    .container { max-width: 720px; margin: 0 auto; padding: 24px; }
    .actions { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 16px; }
    #log { background: #0f172a; color: #e2e8f0; padding: 16px; border-radius: 12px; min-height: 180px; overflow: auto; }
    .text-error { color: #fca5a5; }
  </style>
</head>

<body>
  <main class="container">
    <h1>Smoke Test API</h1>
    <p>API Base: <strong id="apiBase"></strong></p>

    <div class="actions">
      <button id="btnHealth">Test Health</button>
      <button id="btnWhoAmI">Test WhoAmI</button>
      <button id="btnLogout">Logout Firebase</button>
    </div>

    <div id="log"></div>
  </main>
</body>
</html>
